# ストーリーチェッカー Word アドイン

ストーリーチェッカーは、Word文書内のストーリー構造を分析し、論理的な一貫性や修辞表現などの観点から評価を行うWord用アドインです。

## 2回目以降の一発起動用のバッチファイル実行（Windows）

- **エクスプローラーから実行する場合**：
  ファイルをダブルクリックするだけで、バックエンドとフロントエンドの両方のサーバーが別々のコマンドプロンプトウィンドウで起動します。

- **コマンドプロンプトから実行する場合**：
  コマンドプロンプトを開き、プロジェクトのルートディレクトリに移動して以下のコマンドを実行します：
  ```
  start_servers.bat
  ```
  または、絶対パスを指定して実行することもできます：
  ```
  C:\path\to\story_genai\start_servers.bat
  ```

  コマンドプロンプトとワードファイルを閉じるとサーバーが終了します。

> **注意**: バッチファイルでは文字化けを防ぐために、コマンドプロンプトの文字コードをUTF-8（コードページ65001）に設定しています。これにより日本語が正しく表示されます。

## 初回セットアップ

このアプリケーションは以下のソフトウェアを必要とします。インストールされていない場合は、以下の手順でインストールしてください。

### Windows

#### Python のインストール

1. [Python公式サイト](https://www.python.org/downloads/)から最新版のPython（3.8以上推奨）をダウンロードします
2. ダウンロードしたインストーラーを実行します
3. インストール時に「**Add Python to PATH**」にチェックを入れてください
4. インストールが完了したら、コマンドプロンプトを開いて以下のコマンドを実行し、Pythonが正しくインストールされたことを確認します
   ```
   python --version
   ```

#### Node.js のインストール

1. [Node.js公式サイト](https://nodejs.org/)から最新のLTS版をダウンロードします
2. ダウンロードしたインストーラーを実行します
3. インストールが完了したら、コマンドプロンプトを開いて以下のコマンドを実行し、Node.jsが正しくインストールされたことを確認します
   ```
   node --version
   npm --version
   ```

#### Git のインストール

1. [Git公式サイト](https://git-scm.com/download/win)からGitをダウンロードします
2. ダウンロードしたインストーラーを実行します
3. インストールが完了したら、コマンドプロンプトを開いて以下のコマンドを実行し、Gitが正しくインストールされたことを確認します
   ```
   git --version
   ```

## アプリケーションのセットアップ

### リポジトリのクローン

1. コマンドプロンプトを開き、アプリケーションを配置したいディレクトリに移動します
2. 以下のコマンドを実行してリポジトリをクローンします
   ```
   git clone https://github.com/your-username/story_genai.git
   cd story_genai
   ```

### バックエンドのセットアップ

1. バックエンドディレクトリに移動します
   ```
   cd backend
   ```

2. 必要なパッケージをインストールします
   ```
   pip install -r requirements.txt
   ```

4. Azure OpenAI APIの設定を行います。`.env`ファイルを作成し、以下の内容を記入します
   ```
   AZURE_OPENAI_API_KEY=your_api_key
   AZURE_OPENAI_ENDPOINT=your_endpoint
   AZURE_OPENAI_API_VERSION=your_api_version
   AZURE_OPENAI_DEPLOYMENT_NAME=your_deployment_name
   ```

5. バックエンドサーバーを起動します
   ```
   python -m uvicorn app.main:app --reload --port 8000
   ```
   サーバーが正常に起動すると、`http://127.0.0.1:8000`でAPIが利用可能になります。

### フロントエンドのセットアップ

1. 新しいコマンドプロンプトを開き、プロジェクトのルートディレクトリに移動します
2. フロントエンドディレクトリに移動します
   ```
   cd frontend
   ```

3. 必要なパッケージをインストールします
   ```
   npm install
   ```

4. 開発サーバーを起動します
   ```
   npm start
   ```
   サーバーが正常に起動すると、`https://localhost:3000`でアドインの開発版が利用可能になります。

## 二回目以降のサーバー立ち上げ手順　※初回セットアップ後、最上部にバッチファイルを用いた起動方法も記述

初回セットアップ後は、以下の手順でサーバーを起動できます。

### バックエンドサーバーの起動

1. コマンドプロンプトを開き、プロジェクトのバックエンドディレクトリに移動します
   ```
   cd path\to\story_genai\backend
   ```

2. バックエンドサーバーを起動します
   ```
   python -m uvicorn app.main:app --reload --port 8000
   ```

### フロントエンドサーバーの起動

1. 新しいコマンドプロンプトを開き、プロジェクトのフロントエンドディレクトリに移動します
   ```
   cd path\to\story_genai\frontend
   ```

2. 開発サーバーを起動します
   ```
   npm start
   ```


### Word アドインの使用

二回目以降は、以下の手順でアドインを使用できます：

1. バックエンドとフロントエンドのサーバーが起動していることを確認します（個別に起動するか、バッチファイルを使用）
2. Word を起動します
3. 「挿入」タブから「マイアドイン」を選択し、以前にサイドロードした「ストーリーチェッカー」を選択します

これでWordのリボンに「ストーリーチェッカー」タブが表示され、アドインが使用可能になります。

## 使用方法

1. Word文書を開き、分析したいテキストを入力します
2. リボンから「ストーリーチェッカー」タブを選択します
3. 「チェック実行」ボタンをクリックして分析を開始します
4. 分析結果が表示され、問題点があれば該当箇所にコメントが追加されます
5. 各評価観点のボタンをクリックすると、その観点に関する問題のみを表示できます

## トラブルシューティング

### バックエンドサーバーに接続できない場合

- バックエンドサーバーが正常に起動しているか確認してください
- ファイアウォールの設定でポート8000が開放されているか確認してください
- `.env`ファイルのAPI設定が正しいか確認してください

### アドインがWordに表示されない場合

- Word を再起動してみてください
- サイドロードの手順を再度確認してください
- `frontend/manifest.xml`ファイルが正しいか確認してください
